<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Evaluation Review (condition 1)</title>
  <style>
    body {
      font-family: "Century", sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      margin-bottom: 20px;
      color: #333;
    }
    p {
      font-size: 18px;
      line-height: 1.5;
      color: #555;
    }
    table {
      width: 100%;
      margin: 20px 0;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    tr:hover {
      background-color: #f1f1f1;
      cursor: pointer;
    }
    button {
      background-color: #007BFF;
      border: none;
      color: white;
      padding: 15px 30px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    /* Styles for the miniature comb scale */
    .mini-scale {
      position: relative;
      width: 200px;
      height: 40px;
      margin: auto;
      background-color: #fff;
    }
    /* Baseline aligned at 5px from the bottom */
    .mini-base {
      position: absolute;
      bottom: 5px;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: black;
    }
    .mini-tick {
      position: absolute;
      bottom: 5px;
      width: 1px;
      background-color: black;
    }
    /* The red indicator: thinner and positioned further down */
    .mini-indicator {
      position: absolute;
      width: 3px;
      height: 15px;
      background-color: red;
      transform: translateX(-50%);
      bottom: 5px;  /* positioned right above the baseline */
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- These elements will be populated with translated text -->
    <h1 id="pageTitle"></h1>
    <p id="instruction"></p>
    <table id="responsesTable">
      <thead>
        <tr>
          <th id="headerRating"></th>
          <th id="headerResponse"></th>
        </tr>
      </thead>
      <tbody>
        <!-- Table rows will be generated dynamically -->
      </tbody>
    </table>
    <button id="finishBtn" onclick="submitResponses()"></button>
  </div>

  <script>
    // Define translations for English and Italian
    const translations = {
      en: {
        title: "Evaluation Review (condition 1)",
        instruction: "You've finished the evaluation for the first condition. A summary of your responses is shown below for your review. You may click any rating below to go back to the associated question and change your answer. If you're ready to submit your responses, tap Finish.",
        tableHeaderRating: "Rating",
        tableHeaderResponse: "Response",
        finishBtn: "Finish"
      },
      it: {
        title: "Revisione della Valutazione (condizione 1)",
        instruction: "Hai completato la valutazione per la prima condizione. Un riepilogo delle tue risposte Ã¨ mostrato di seguito per la tua revisione. Puoi cliccare su qualsiasi scala di valutazione per tornare alla domanda associata e modificare la tua risposta. Se sei pronto per inviare le tue risposte, premi Fine.",
        tableHeaderRating: "Scala",
        tableHeaderResponse: "Risposta",
        finishBtn: "Fine"
      }
    };

    // Load language from localStorage or default to English
    let selectedLang = localStorage.getItem("language") || "en";

    // Apply translations to the page elements
    document.getElementById("pageTitle").innerText = translations[selectedLang].title;
    document.getElementById("instruction").innerText = translations[selectedLang].instruction;
    document.getElementById("headerRating").innerText = translations[selectedLang].tableHeaderRating;
    document.getElementById("headerResponse").innerText = translations[selectedLang].tableHeaderResponse;
    document.getElementById("finishBtn").innerText = translations[selectedLang].finishBtn;
  </script>

  <script>
    // Retrieve the ratingsTable from localStorage (or use an empty array if not present)
    let ratingsTable = JSON.parse(localStorage.getItem("ratingsTable")) || [];

    // Names of the ratings in order (can be localized if needed)
    const ratingNames = [
      "Mental Demand",
      "Physical Demand",
      "Temporal Demand",
      "Performance",
      "Effort",
      "Frustration"
    ];

    /**
     * Generates the HTML for a miniature comb scale.
     * The baseline is aligned at 5px from the bottom, the central tick is taller,
     * and the red indicator (cursor) is thinner and positioned close above the baseline.
     * @param {number} value - The slider value (0 to 100) determining the red indicator's position.
     * @returns {string} The HTML string representing the miniature scale.
     */
    function getMiniScaleHTML(value) {
      // Default to 50 if no value is provided
      let sliderValue = (typeof value === "number") ? value : 50;
      let ticksHTML = "";
      // Generate 21 tick marks (from 0 to 20)
      for (let i = 0; i <= 20; i++) {
        let leftPercent = (i / 20) * 100;
        if (i === 10) {
          ticksHTML += `<div class="mini-tick" style="left:${leftPercent}%; height:20px;"></div>`;
        } else {
          ticksHTML += `<div class="mini-tick" style="left:${leftPercent}%; height:10px;"></div>`;
        }
      }
      // Position the red indicator based on the slider value (as a percentage)
      let indicatorHTML = `<div class="mini-indicator" style="left:${sliderValue}%;"></div>`;
      return `
        <div class="mini-scale">
          <div class="mini-base"></div>
          ${ticksHTML}
          ${indicatorHTML}
        </div>
      `;
    }

    // Populate the table with a summary of responses
    const tbody = document.getElementById("responsesTable").querySelector("tbody");
    ratingsTable.forEach((entry, index) => {
      const row = document.createElement("tr");
      // On click, save the currentRatingIndex to localStorage and redirect to rating_scales_1.html
      row.addEventListener("click", function() {
        localStorage.setItem("currentRatingIndex", index);
        window.location.href = "rating_scales_1.html";
      });
      
      const tdRating = document.createElement("td");
      tdRating.textContent = ratingNames[index] || ("Rating " + (index + 1));
      
      const tdScale = document.createElement("td");
      // Use the saved sliderValue if available; otherwise, default to 50
      const sliderValue = (entry && entry.sliderValue !== undefined) ? entry.sliderValue : 50;
      tdScale.innerHTML = getMiniScaleHTML(sliderValue);
      
      row.appendChild(tdRating);
      row.appendChild(tdScale);
      tbody.appendChild(row);
    });

    function submitResponses() {
      // Implement submission logic here (e.g., sending data to a server)
      alert("Responses submitted!");
      console.log("Submitted responses:", ratingsTable);
    }
  </script>
</body>
</html>
