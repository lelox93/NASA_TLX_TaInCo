<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="pageTitle">Evaluation Review (condizione 1)</title>
  <style>
    body {
      font-family: "Century", sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 20px;
      text-align: center;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      margin-bottom: 20px;
      color: #333;
    }
    p {
      font-size: 18px;
      line-height: 1.5;
      margin-bottom: 20px;
      color: #555;
      white-space: pre-wrap;
    }
    table {
      width: 100%;
      margin: 20px 0;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    tr:hover {
      background-color: #f1f1f1;
      cursor: pointer;
    }
    button {
      background-color: #007BFF;
      border: none;
      color: white;
      padding: 15px 30px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    /* Styles for the miniature comb scale */
    .mini-scale {
      position: relative;
      width: 200px;
      height: 40px;
      margin: auto;
      background-color: #fff;
    }
    .mini-base {
      position: absolute;
      bottom: 5px;
      left: 0;
      width: 100%;
      height: 2px;
      background-color: black;
    }
    .mini-tick {
      position: absolute;
      bottom: 5px;
      width: 1px;
      background-color: black;
    }
    .mini-indicator {
      position: absolute;
      width: 3px;      /* thinner */
      height: 15px;    /* slightly shorter */
      background-color: red;
      transform: translateX(-50%);
      bottom: 5px;     /* positioned right above the baseline */
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 id="pageTitle"></h1>
    <p id="instruction"></p>
    <table id="responsesTable">
      <thead>
        <tr>
          <th id="headerRating"></th>
          <th id="headerResponse"></th>
        </tr>
      </thead>
      <tbody>
        <!-- Rows will be generated dynamically -->
      </tbody>
    </table>
    <button id="finishBtn" onclick="submitResponses()"></button>
  </div>

  <script>
    // Define translations for the page
    const translations = {
      en: {
        title: "Evaluation Review (condition 1)",
        instruction: "You've finished the evaluation for the first condition. A summary of your responses is shown below for your review. You may click any rating below to go back to the associated question and change your answer.\n\nIf you're ready to submit your responses, tap Finish.",
        tableHeaderRating: "Rating",
        tableHeaderResponse: "Response",
        finishBtn: "Finish"
      },
      it: {
        title: "Revisione della Valutazione (condizione 1)",
        instruction: "Hai completato la valutazione per la prima condizione. Un riepilogo delle tue risposte Ã¨ mostrato di seguito per la tua revisione. Puoi cliccare su qualsiasi scala per tornare alla domanda associata e modificare la tua risposta.\n\nSe sei pronto per inviare le tue risposte, premi Fine.",
        tableHeaderRating: "Scala",
        tableHeaderResponse: "Risposta",
        finishBtn: "Fine"
      }
    };

    // Load language from localStorage or default to English
    let selectedLang = localStorage.getItem("language") || "en";

    // Apply translations to page elements
    document.getElementById("pageTitle").innerText = translations[selectedLang].title;
    document.getElementById("instruction").innerText = translations[selectedLang].instruction;
    document.getElementById("headerRating").innerText = translations[selectedLang].tableHeaderRating;
    document.getElementById("headerResponse").innerText = translations[selectedLang].tableHeaderResponse;
    document.getElementById("finishBtn").innerText = translations[selectedLang].finishBtn;

    // Set rating names based on language
    const ratingNames = selectedLang === "it" ? [
      "Richiesta Mentale",
      "Richiesta Fisica",
      "Richiesta Temporale",
      "Prestazione",
      "Sforzo",
      "Frustrazione"
    ] : [
      "Mental Demand",
      "Physical Demand",
      "Temporal Demand",
      "Performance",
      "Effort",
      "Frustration"
    ];

    /**
     * Generates the HTML for a miniature comb scale.
     * The baseline is aligned at 5px from the bottom, the central tick is taller,
     * and the red indicator (cursor) is thinner and positioned just above the baseline.
     * @param {number} value - The slider value (0 to 100) determining the red indicator's position.
     * @returns {string} The HTML string representing the miniature scale.
     */
    function getMiniScaleHTML(value) {
      let sliderValue = (typeof value === "number") ? value : 50;
      let ticksHTML = "";
      // Generate 21 tick marks (from 0 to 20)
      for (let i = 0; i <= 20; i++) {
        let leftPercent = (i / 20) * 100;
        if (i === 10) {
          ticksHTML += `<div class="mini-tick" style="left:${leftPercent}%; height:20px;"></div>`;
        } else {
          ticksHTML += `<div class="mini-tick" style="left:${leftPercent}%; height:10px;"></div>`;
        }
      }
      let indicatorHTML = `<div class="mini-indicator" style="left:${sliderValue}%;"></div>`;
      return `
        <div class="mini-scale">
          <div class="mini-base"></div>
          ${ticksHTML}
          ${indicatorHTML}
        </div>
      `;
    }

    // Retrieve the ratingsTable from localStorage (assumed to be stored as an array)
    let ratingsTable = JSON.parse(localStorage.getItem("ratingsTable")) || [];

    // Populate the table with a summary of responses
    const tbody = document.getElementById("responsesTable").querySelector("tbody");
    ratingsTable.forEach((entry, index) => {
      const row = document.createElement("tr");
      // When clicking a row, set currentRatingIndex in localStorage and redirect to rating_scales_1.html
      row.addEventListener("click", function() {
        localStorage.setItem("currentRatingIndex", index);
        window.location.href = "rating_scales_1.html";
      });
      
      const tdRating = document.createElement("td");
      tdRating.textContent = ratingNames[index] || ("Rating " + (index + 1));
      
      const tdScale = document.createElement("td");
      const sliderValue = (entry && entry.sliderValue !== undefined) ? entry.sliderValue : 50;
      tdScale.innerHTML = getMiniScaleHTML(sliderValue);
      
      row.appendChild(tdRating);
      row.appendChild(tdScale);
      tbody.appendChild(row);
    });

    function submitResponses() {
      // Implement submission logic here (e.g., sending data to a server)
      alert("Responses submitted!");
      console.log("Submitted responses:", ratingsTable);
    }
  </script>
</body>
</html>
